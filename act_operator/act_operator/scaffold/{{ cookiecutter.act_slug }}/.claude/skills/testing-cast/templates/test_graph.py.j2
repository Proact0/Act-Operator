"""Tests for {{ cast_name }} graph."""

import pytest
from langgraph.checkpoint.memory import MemorySaver
from casts.{{ cast_name }}.graph import {{ graph_class_name }}


class Test{{ graph_class_name }}:
    """Test suite for {{ graph_class_name }}."""

    @pytest.fixture
    def graph(self):
        """Provides compiled graph."""
        graph_builder = {{ graph_class_name }}()
        return graph_builder.build()

    @pytest.fixture
    def graph_with_memory(self):
        """Provides graph with checkpointer."""
        graph_builder = {{ graph_class_name }}()
        checkpointer = MemorySaver()
        return graph_builder.build(checkpointer=checkpointer)

    def test_graph_compiles(self, graph):
        """Graph should compile without errors."""
        assert graph is not None
        assert hasattr(graph, "invoke")

    def test_graph_invoke_basic(self, graph):
        """Test basic graph invocation."""
        initial_state = {"input": "test"}

        result = graph.invoke(initial_state)

        assert result is not None
        assert isinstance(result, dict)

    def test_graph_with_config(self, graph_with_memory):
        """Test graph with thread configuration."""
        config = {"configurable": {"thread_id": "test-123"}}
        initial_state = {"input": "test"}

        result = graph_with_memory.invoke(initial_state, config=config)

        assert result is not None

    def test_graph_streaming(self, graph):
        """Test graph streaming."""
        initial_state = {"input": "test"}

        chunks = list(graph.stream(initial_state, stream_mode="updates"))

        assert len(chunks) > 0

    # TODO: Add more specific tests

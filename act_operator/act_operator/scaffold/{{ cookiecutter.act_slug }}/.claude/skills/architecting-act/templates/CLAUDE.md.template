# {{CAST_NAME}} Architecture

**Created:** {{DATE}}
**Workflow Pattern:** {{WORKFLOW_PATTERN}}

---

## Purpose

{{PURPOSE}}

---

## Workflow Pattern Selection

**Pattern:** {{WORKFLOW_PATTERN}}

**Rationale:**

{{PATTERN_RATIONALE}}

**Alternatives Considered:**
- _Document why other patterns were not chosen_

---

## State Schema Design

### Input State

Fields provided at graph invocation:

{{INPUT_STATE_TABLE}}

### Working State

Intermediate fields updated during execution:

{{WORKING_STATE_TABLE}}

### Output State

Final results returned to caller:

{{OUTPUT_STATE_TABLE}}

### State Design Rationale

_Explain key state design decisions, why certain reducers were chosen, and how state supports the workflow._

---

## Node Architecture

### Node Breakdown

{{NODES_TABLE}}

### Node Design Principles

**SOLID Adherence:**
- Each node has single responsibility
- Dependencies are explicit (documented in reads/writes)
- Nodes are testable in isolation

**Parallel Execution:**
- _List nodes that can execute in parallel_
- _Document why they're independent_

**Sequential Requirements:**
- _List nodes that must execute sequentially_
- _Document dependencies_

---

## Edge & Routing Design

### Edge Flow

{{EDGE_FLOW}}

### Routing Logic

{{ROUTING_LOGIC}}

### Loop Conditions

**If applicable:**
- Loop entry condition: _When does loop start?_
- Loop continuation condition: _When does loop continue?_
- Loop exit conditions:
  - Success: _When is goal achieved?_
  - Max iterations: _What is the limit?_
  - Error: _When to give up?_

### Error Handling

{{ERROR_HANDLING}}

---

{{SUBGRAPHS_SECTION}}

---

## Architecture Diagram

{{MERMAID_DIAGRAM}}

**Note:** This diagram represents the high-level flow. Refer to node and edge sections for detailed routing logic.

---

## Implementation Guidance

### For the developing-cast Skill

This section provides guidance for implementing this architecture.

#### State Implementation

**State Type:** Use TypedDict or Pydantic model

**Reducers to implement:**
- _List fields that need custom reducers_
- _Specify reducer functions (operator.add, custom merge, etc.)_

**Validation:**
- _Input validation requirements_
- _State invariants to maintain_

#### Node Implementation Priorities

**Phase 1 - Core Flow:**
1. _List nodes to implement first (main path)_

**Phase 2 - Error Handling:**
1. _List error handling nodes_

**Phase 3 - Optimizations:**
1. _List optional/enhancement nodes_

#### Testing Strategy

**Unit Tests:**
- Test each node independently
- Mock state inputs
- Assert state outputs

**Integration Tests:**
- Test complete graph execution
- Test error paths
- Test edge cases (max iterations, invalid inputs, etc.)

#### Implementation Notes

{{IMPLEMENTATION_NOTES}}

---

## Architectural Decisions Record

### Key Decisions

**Decision 1: [Decision Name]**
- **Context:** _What was the situation?_
- **Decision:** _What was decided?_
- **Rationale:** _Why?_
- **Alternatives:** _What else was considered?_
- **Consequences:** _What are the trade-offs?_

_(Add more decision records as needed)_

---

## Performance Considerations

**Expected Latency:** _Based on pattern and complexity_

**Cost Factors:**
- LLM calls: _Estimate number and size_
- Tool calls: _External API usage_
- Parallel vs sequential impact

**Optimization Opportunities:**
- _Potential areas for performance improvement_
- _When to revisit these decisions_

---

## Future Enhancements

**Possible Evolutions:**
- _Features that might be added later_
- _How architecture could be extended_
- _What would trigger architectural changes_

---

## References

**Resources Used:**
- [Workflow Patterns](/.claude/skills/architecting-act/resources/workflow-patterns.md)
- [State Design Guide](/.claude/skills/architecting-act/resources/state-design-guide.md)
- [Node Architecture Guide](/.claude/skills/architecting-act/resources/node-architecture-guide.md)
- [Edge Routing Guide](/.claude/skills/architecting-act/resources/edge-routing-guide.md)
- [Subgraph Decisions](/.claude/skills/architecting-act/resources/subgraph-decisions.md)

**LangGraph Documentation:**
- [LangGraph Official Docs](https://langchain-ai.github.io/langgraph/)

---

## Validation

**Anti-Patterns Checked:**
- [ ] No god nodes (all nodes < 100 lines)
- [ ] No kitchen sink state (< 15 fields)
- [ ] No infinite loops (all loops have max iterations)
- [ ] Error handling paths defined
- [ ] SOLID principles applied
- [ ] Pattern matches requirements (latency, complexity)

**Validation Script:**
```bash
uv run python .claude/skills/architecting-act/scripts/validate_architecture.py --input CLAUDE.md
```

---

## Approval & Sign-off

**Architecture Status:** [Draft | Reviewed | Approved]

**Reviewed By:** _Name/Role_
**Date:** _YYYY-MM-DD_

**Approval Notes:**
_Any conditions or caveats for implementation_

---

## Next Steps

1. **Review this architecture document** - Ensure it accurately captures the design
2. **Run validation script** - Check for anti-patterns and issues
3. **Get stakeholder approval** - If required
4. **Proceed to implementation** - Use the `developing-cast` skill:
   ```
   /developing-cast
   ```

---

**Document Version:** 1.0
**Last Updated:** {{DATE}}
